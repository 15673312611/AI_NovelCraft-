# AI纠错功能说明

## 功能概述

新增了AI智能纠错功能，可以检测文本中的错别字、名称错误、乱码等问题，并提供一键修复功能。

## 功能特点

### 1. 智能检测
- **错别字检测**：识别错误的汉字、同音字误用、形近字误用
- **名称一致性检查**：检测人名、地名、物品名等专有名词前后不一致
- **乱码检测**：发现无意义的字符、符号、特殊字符
- **标点错误**：检查中英文标点混用、标点使用不当
- **其他错误**：语法错误、逻辑矛盾等

### 2. 友好的用户界面
- **错误分类标签**：不同类型的错误用不同颜色标识
- **上下文展示**：显示错误所在的上下文，方便判断
- **原文对比**：清晰展示原文和建议修改
- **错误原因说明**：AI会解释为什么认为这是错误

### 3. 灵活的修复方式
- **单个应用**：可以选择性地应用某个修改
- **批量应用**：一键应用所有修改
- **已修复标记**：已应用的修改会被标记，避免重复操作

## 使用方法

### 在写作工作室中使用

1. 打开任意章节进行编辑
2. 点击顶部工具栏的 **🔍 纠错** 按钮
3. 在弹出的对话框中点击 **🔍 开始检查**
4. 等待AI检查完成（通常需要几秒钟）
5. 查看检测到的错误列表
6. 选择操作：
   - 点击单个错误右侧的 **应用** 按钮，应用该修改
   - 点击底部的 **✅ 应用全部** 按钮，应用所有修改
   - 点击 **关闭** 按钮，不做任何修改

## 技术实现

### 后端

#### AIProofreadService.java
- 负责调用AI接口进行文本检查
- 解析AI返回的JSON格式错误列表
- 自动生成错误位置的上下文
- 支持传入角色名称列表以提高检测准确性

#### AIController.java
- 新增 `/ai/proofread` 接口
- 接收文本内容和可选的角色名称列表
- 返回结构化的错误列表

### 前端

#### aiService.ts
- 新增 `proofread` 方法
- 自动附加AI配置信息

#### EditorPanel.tsx
- 新增纠错按钮和弹窗
- 实现错误列表展示
- 实现单个/批量应用修改功能
- 自动标记已应用的修改

## AI提示词优化

同时优化了AI润色功能的提示词，让文字更日常、更像人类作家：

### 优化重点

1. **用日常语言，别装文艺**
   - 避免：他的内心如同暴风雨般翻涌
   - 改为：他心里乱得很

2. **少用形容词，多用动作和细节**
   - 避免：他非常愤怒地说
   - 改为：他一拍桌子

3. **对话要像真人说话**
   - 避免：我认为这件事情需要我们仔细考虑
   - 改为：这事儿……咱得好好想想

4. **句子长短要有变化**
   - 避免机械重复的句式
   - 使用自然的语言节奏

5. **删掉"很AI"的词**
   - 删除：然而、总而言之、毋庸置疑
   - 删除：最、绝对、终极、完美

6. **情绪别直说，让读者自己感受**
   - 避免：他感到绝望
   - 改为：他愣在那里，半天说不出话

7. **别用太多比喻**
   - 避免：危机如同风暴般席卷而来
   - 改为：麻烦来了

8. **称呼要自然**
   - 避免连续使用"他/她"
   - 使用角色名字或特征

9. **标点别乱用**
   - 减少不必要的引号
   - 保持标点简洁

10. **保持口语化**
    - 像在讲故事一样自然

## 注意事项

1. **AI检测不是100%准确**：建议人工审核后再应用修改
2. **保持作者风格**：AI会尊重作者的写作风格，不会过度纠正
3. **专有名词**：对于小说中的特殊设定和专有名词，AI可能会误判
4. **网络用语**：口语化表达不会被当作错误

## 未来优化方向

1. 支持从小说信息中自动获取角色名称列表
2. 支持自定义专有名词词典
3. 支持批量检查多个章节
4. 支持导出检查报告

